# goose 아키텍처 이해하기

이 문서는 goose, Ollama(LLM), MCP 서버의 역할과 관계를 설명합니다. 각 구성요소가 어떻게 협력하여 AI 에이전트 시스템을 구성하는지 이해할 수 있습니다.

## 목차

1. [핵심 개념](#핵심-개념)
2. [아키텍처 다이어그램](#아키텍처-다이어그램)
3. [각 구성요소의 역할](#각-구성요소의-역할)
4. [실행 흐름 예시](#실행-흐름-예시)
5. [goose 없이 LLM만 사용하면?](#goose-없이-llm만-사용하면)
6. [goose의 핵심 가치](#goose의-핵심-가치)
7. [자주 하는 오해](#자주-하는-오해)

---

## 핵심 개념

### 한 줄 요약

| 구성요소 | 역할 | 비유 |
|----------|------|------|
| **Ollama (LLM)** | 생각하고 판단하는 추론 엔진 | 두뇌 |
| **goose** | 전체 흐름을 조율하는 에이전트 | 지휘자/조종사 |
| **MCP 서버** | 실제 작업을 수행하는 도구들 | 손과 발 |

### 쉬운 비유: 회사 조직

```
┌─────────────────────────────────────────────────────────────┐
│                      회사 비유                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   고객 (사용자)                                              │
│     │                                                       │
│     │ "이 프로젝트 분석 보고서 만들어주세요"                   │
│     ▼                                                       │
│   ┌─────────────────────────────────────────┐               │
│   │           프로젝트 매니저 (goose)         │               │
│   │   • 고객 요청 접수                        │               │
│   │   • 누구에게 어떤 일을 시킬지 결정         │               │
│   │   • 결과물 취합 및 전달                   │               │
│   └──────────┬────────────────┬─────────────┘               │
│              │                │                             │
│              ▼                ▼                             │
│   ┌──────────────┐    ┌──────────────────┐                  │
│   │ 분석가 (LLM)  │    │ 실무자 (MCP 서버) │                  │
│   │              │    │                  │                  │
│   │ • 무엇을 해야 │    │ • 파일 읽기       │                  │
│   │   하는지 판단 │    │ • 코드 실행       │                  │
│   │ • 보고서 작성 │    │ • 검색 수행       │                  │
│   └──────────────┘    └──────────────────┘                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 아키텍처 다이어그램

### 전체 구조

```
┌─────────────────────────────────────────────────────────────────────┐
│                        goose 시스템 아키텍처                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌─────────────┐                                                   │
│   │   사용자     │                                                   │
│   │  (CLI/GUI)  │                                                   │
│   └──────┬──────┘                                                   │
│          │ 명령/질문                                                 │
│          ▼                                                          │
│   ┌─────────────────────────────────────────────────────────┐       │
│   │                                                         │       │
│   │                    goose (에이전트)                      │       │
│   │                                                         │       │
│   │  ┌───────────────────────────────────────────────────┐  │       │
│   │  │                  핵심 기능                         │  │       │
│   │  ├───────────────────────────────────────────────────┤  │       │
│   │  │ • 세션 관리 (대화 기록, 상태 유지)                  │  │       │
│   │  │ • 대화 흐름 제어 (멀티턴 대화 관리)                 │  │       │
│   │  │ • 도구 선택 및 호출 (LLM 요청 → MCP 실행)          │  │       │
│   │  │ • 결과 조합 (여러 도구 결과를 통합)                 │  │       │
│   │  │ • 컨텍스트 관리 (토큰 제한 내 최적화)               │  │       │
│   │  │ • 압축 (Compaction) (긴 대화 요약)                 │  │       │
│   │  │ • 권한 제어 (위험한 작업 승인 요청)                 │  │       │
│   │  │ • 레시피 실행 (사전 정의된 워크플로우)              │  │       │
│   │  │ • 메모리 관리 (세션 간 정보 유지)                   │  │       │
│   │  └───────────────────────────────────────────────────┘  │       │
│   │                                                         │       │
│   └──────────┬───────────────────────────┬──────────────────┘       │
│              │                           │                          │
│      추론 요청│                           │도구 실행 요청             │
│              ▼                           ▼                          │
│   ┌─────────────────────┐     ┌─────────────────────────────┐       │
│   │                     │     │                             │       │
│   │   LLM Provider      │     │      MCP 서버들              │       │
│   │                     │     │                             │       │
│   │  ┌───────────────┐  │     │  ┌─────────────────────┐    │       │
│   │  │ Ollama        │  │     │  │ developer           │    │       │
│   │  │ (로컬 LLM)    │  │     │  │ • 파일 읽기/쓰기    │    │       │
│   │  └───────────────┘  │     │  │ • 셸 명령 실행      │    │       │
│   │  ┌───────────────┐  │     │  │ • 코드 검색         │    │       │
│   │  │ OpenAI        │  │     │  └─────────────────────┘    │       │
│   │  │ (GPT-4 등)    │  │     │  ┌─────────────────────┐    │       │
│   │  └───────────────┘  │     │  │ memory              │    │       │
│   │  ┌───────────────┐  │     │  │ • 정보 저장/검색    │    │       │
│   │  │ Anthropic     │  │     │  └─────────────────────┘    │       │
│   │  │ (Claude 등)   │  │     │  ┌─────────────────────┐    │       │
│   │  └───────────────┘  │     │  │ 기타 확장 기능       │    │       │
│   │  ┌───────────────┐  │     │  │ • GitHub, Google    │    │       │
│   │  │ 기타 Provider │  │     │  │ • 커스텀 MCP 서버   │    │       │
│   │  └───────────────┘  │     │  └─────────────────────┘    │       │
│   │                     │     │                             │       │
│   │      "두뇌"         │     │        "손과 발"             │       │
│   │   생각하고 판단     │     │     실제 작업 수행           │       │
│   │                     │     │                             │       │
│   └─────────────────────┘     └─────────────────────────────┘       │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

### 데이터 흐름

```
┌────────────────────────────────────────────────────────────────────┐
│                         데이터 흐름                                 │
├────────────────────────────────────────────────────────────────────┤
│                                                                    │
│  사용자 입력                                                        │
│      │                                                             │
│      ▼                                                             │
│  ┌────────┐    프롬프트     ┌────────┐    도구 호출    ┌────────┐  │
│  │ goose  │ ───────────▶  │  LLM   │  ───────────▶  │  MCP   │  │
│  │        │               │        │               │ 서버   │  │
│  │        │  ◀─────────── │        │  ◀─────────── │        │  │
│  └────────┘    추론 결과    └────────┘    실행 결과    └────────┘  │
│      │                                                             │
│      ▼                                                             │
│  사용자에게 응답                                                    │
│                                                                    │
└────────────────────────────────────────────────────────────────────┘
```

---

## 각 구성요소의 역할

### 1. goose (에이전트 프레임워크)

goose는 전체 시스템의 **지휘자** 역할을 합니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    goose의 책임                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  📋 세션 관리                                                │
│     • 대화 기록 저장 및 로드                                  │
│     • 세션 상태 유지                                         │
│     • 세션 간 전환                                           │
│                                                             │
│  🔄 대화 흐름 제어                                           │
│     • 사용자 입력 수신                                       │
│     • LLM에게 적절한 프롬프트 전달                            │
│     • 멀티턴 대화 관리                                       │
│                                                             │
│  🔧 도구 오케스트레이션                                       │
│     • LLM이 요청한 도구 식별                                  │
│     • MCP 서버에 도구 실행 요청                               │
│     • 실행 결과를 LLM에게 전달                                │
│                                                             │
│  📊 컨텍스트 관리                                            │
│     • 토큰 사용량 추적                                       │
│     • 컨텍스트 윈도우 최적화                                  │
│     • 필요시 압축(Compaction) 수행                           │
│                                                             │
│  🔐 권한 및 보안                                             │
│     • 위험한 작업 감지                                       │
│     • 사용자 승인 요청                                       │
│     • 권한 모드 적용 (Auto/Smart/Manual)                     │
│                                                             │
│  📦 확장성                                                   │
│     • 다양한 LLM Provider 지원                               │
│     • MCP 서버 동적 로드                                     │
│     • 레시피 시스템                                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2. LLM (Ollama 등)

LLM은 시스템의 **두뇌** 역할을 합니다.

```
┌─────────────────────────────────────────────────────────────┐
│                      LLM의 책임                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🧠 자연어 이해                                              │
│     • 사용자 의도 파악                                       │
│     • 맥락 이해                                              │
│     • 모호한 표현 해석                                       │
│                                                             │
│  💭 추론 및 판단                                             │
│     • 어떤 작업이 필요한지 결정                               │
│     • 어떤 도구를 사용할지 선택                               │
│     • 결과를 어떻게 해석할지 판단                             │
│                                                             │
│  ✍️ 텍스트 생성                                              │
│     • 사용자에게 전달할 응답 작성                             │
│     • 코드 생성                                              │
│     • 문서 작성                                              │
│                                                             │
│  🔧 도구 호출 결정                                           │
│     • 필요한 도구와 매개변수 지정                             │
│     • 도구 호출 순서 결정                                    │
│                                                             │
│  ⚠️ LLM이 할 수 없는 것                                      │
│     • 파일 시스템 접근 ❌                                     │
│     • 명령어 실행 ❌                                         │
│     • 네트워크 요청 ❌                                       │
│     • 외부 시스템 상호작용 ❌                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3. MCP 서버 (도구들)

MCP 서버는 시스템의 **손과 발** 역할을 합니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    MCP 서버의 책임                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  📁 developer (내장)                                         │
│     • 파일 읽기/쓰기/수정                                    │
│     • 디렉토리 탐색                                          │
│     • 셸 명령 실행                                           │
│     • 코드 검색                                              │
│                                                             │
│  🧠 memory (내장)                                            │
│     • 정보 저장                                              │
│     • 정보 검색                                              │
│     • 세션 간 기억 유지                                      │
│                                                             │
│  🖥️ computercontroller (선택)                               │
│     • 스크린샷 캡처                                          │
│     • 마우스/키보드 제어                                     │
│     • 화면 분석                                              │
│                                                             │
│  🔌 외부 확장 (선택)                                         │
│     • GitHub: PR, 이슈 관리                                  │
│     • Google Drive: 문서 접근                                │
│     • 데이터베이스: SQL 실행                                 │
│     • 커스텀: 사용자 정의 도구                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 실행 흐름 예시

### 예시: "src 폴더의 Java 파일을 분석해줘"

```
┌─────────────────────────────────────────────────────────────────────┐
│                         실행 흐름 상세                               │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  1️⃣ 사용자 입력                                                     │
│     ┌─────────────────────────────────────────┐                     │
│     │ "src 폴더의 Java 파일을 분석해줘"        │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                          ▼                                          │
│  2️⃣ goose: 입력 수신 및 LLM에 전달                                  │
│     ┌─────────────────────────────────────────┐                     │
│     │ • 세션 컨텍스트와 함께 프롬프트 구성      │                     │
│     │ • 사용 가능한 도구 목록 첨부              │                     │
│     │ • LLM에게 전송                           │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                          ▼                                          │
│  3️⃣ LLM: 분석 및 도구 호출 결정                                     │
│     ┌─────────────────────────────────────────┐                     │
│     │ 생각: "Java 파일을 찾아야 한다"          │                     │
│     │ 결정: developer.shell 도구로             │                     │
│     │       "find src -name '*.java'" 실행    │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                          ▼                                          │
│  4️⃣ goose: 도구 호출 요청 처리                                      │
│     ┌─────────────────────────────────────────┐                     │
│     │ • LLM의 도구 호출 요청 파싱              │                     │
│     │ • 권한 확인 (필요시 사용자 승인)         │                     │
│     │ • MCP 서버(developer)에 요청 전달        │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                          ▼                                          │
│  5️⃣ MCP (developer): 실제 작업 수행                                 │
│     ┌─────────────────────────────────────────┐                     │
│     │ • 파일 시스템에서 Java 파일 목록 조회    │                     │
│     │ • 결과: ["App.java", "User.java", ...]  │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                          ▼                                          │
│  6️⃣ goose: 결과를 LLM에게 전달                                      │
│     ┌─────────────────────────────────────────┐                     │
│     │ • 도구 실행 결과를 컨텍스트에 추가       │                     │
│     │ • LLM에게 다음 단계 요청                 │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                          ▼                                          │
│  7️⃣ LLM: 추가 도구 호출 (반복)                                      │
│     ┌─────────────────────────────────────────┐                     │
│     │ 생각: "각 파일 내용을 읽어야 한다"       │                     │
│     │ 결정: developer.read_file 도구로         │                     │
│     │       각 Java 파일 읽기                  │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                   (4-6 단계 반복)                                    │
│                          │                                          │
│                          ▼                                          │
│  8️⃣ LLM: 최종 분석 및 응답 생성                                     │
│     ┌─────────────────────────────────────────┐                     │
│     │ • 수집된 모든 정보를 종합                │                     │
│     │ • 분석 결과 텍스트 생성                  │                     │
│     │ • 구조화된 응답 작성                     │                     │
│     └─────────────────────────────────────────┘                     │
│                          │                                          │
│                          ▼                                          │
│  9️⃣ goose: 사용자에게 응답 전달                                     │
│     ┌─────────────────────────────────────────┐                     │
│     │ • 응답 포맷팅                            │                     │
│     │ • 세션 기록 업데이트                     │                     │
│     │ • 사용자에게 표시                        │                     │
│     └─────────────────────────────────────────┘                     │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## goose 없이 LLM만 사용하면?

### Ollama 단독 사용의 한계

```bash
# Ollama만 사용하는 경우
$ ollama run qwen2.5-coder:7b "src 폴더의 Java 파일을 분석해줘"

# LLM의 응답:
# "죄송합니다. 저는 실제 파일 시스템에 접근할 수 없습니다.
#  파일 내용을 직접 보여주시면 분석해 드리겠습니다."
```

### 비교표

| 기능 | Ollama 단독 | goose + Ollama |
|------|-------------|----------------|
| 파일 읽기 | ❌ 불가능 | ✅ 가능 |
| 코드 실행 | ❌ 불가능 | ✅ 가능 |
| 파일 수정 | ❌ 불가능 | ✅ 가능 |
| 웹 검색 | ❌ 불가능 | ✅ 가능 (확장) |
| 멀티턴 대화 | ⚠️ 수동 관리 | ✅ 자동 관리 |
| 작업 자동화 | ❌ 불가능 | ✅ 가능 |
| 기억 유지 | ❌ 불가능 | ✅ 가능 |

### 왜 이런 차이가 있나요?

```
┌─────────────────────────────────────────────────────────────┐
│                     LLM의 본질적 한계                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  LLM은 "텍스트 → 텍스트" 변환기입니다                        │
│                                                             │
│  ┌─────────────┐          ┌─────────────┐                   │
│  │   입력      │   LLM    │   출력      │                   │
│  │   텍스트    │ ───────▶ │   텍스트    │                   │
│  └─────────────┘          └─────────────┘                   │
│                                                             │
│  LLM이 "파일을 읽어라"고 말해도:                             │
│  • 그것은 단지 텍스트 출력일 뿐                              │
│  • 실제로 파일을 읽는 능력은 없음                            │
│  • 누군가가 그 요청을 실행해야 함 → goose의 역할             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## goose의 핵심 가치

### 1. 도구 연결 (Tool Bridging)

```
┌─────────────────────────────────────────────────────────────┐
│  LLM의 "생각"을 실제 "행동"으로 변환                         │
│                                                             │
│  LLM: "파일을 읽어야겠다"                                    │
│          │                                                  │
│          ▼ goose가 해석                                     │
│  MCP: developer.read_file("/path/to/file")                 │
│          │                                                  │
│          ▼ 실제 실행                                        │
│  결과: 파일 내용 반환                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 2. 자율 실행 (Autonomous Execution)

```
사용자: "테스트 실패 원인을 찾아서 고쳐줘"

goose가 자동으로 수행:
  1. 테스트 실행 → 실패 확인
  2. 에러 메시지 분석
  3. 관련 소스 코드 읽기
  4. 원인 파악
  5. 코드 수정
  6. 테스트 재실행 → 성공 확인
  7. 결과 보고
```

### 3. 컨텍스트 관리 (Context Management)

```
┌─────────────────────────────────────────────────────────────┐
│  긴 대화에서도 효율적인 토큰 관리                            │
│                                                             │
│  대화 시작 ─────────────────────────────────▶ 대화 진행     │
│                                                             │
│  [메시지1][메시지2][메시지3]...[메시지N]                     │
│                     │                                       │
│                     ▼ 컨텍스트 윈도우 한계 도달              │
│                                                             │
│  goose 자동 압축:                                           │
│  [요약된 이전 대화][최근 메시지들]                           │
│                                                             │
│  → 중요 정보 유지하면서 토큰 절약                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4. 권한 제어 (Permission Control)

```
┌─────────────────────────────────────────────────────────────┐
│  위험한 작업 보호                                            │
│                                                             │
│  LLM: "rm -rf / 실행하겠습니다"                              │
│          │                                                  │
│          ▼ goose 권한 체크                                  │
│  ┌─────────────────────────────────────┐                    │
│  │  ⚠️ 위험한 명령이 감지되었습니다      │                    │
│  │                                     │                    │
│  │  실행하려는 명령: rm -rf /          │                    │
│  │                                     │                    │
│  │  [허용]  [거부]  [항상 거부]         │                    │
│  └─────────────────────────────────────┘                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5. 확장성 (Extensibility)

```
┌─────────────────────────────────────────────────────────────┐
│  다양한 LLM과 도구 조합 가능                                 │
│                                                             │
│          ┌─────────────┐                                    │
│          │             │                                    │
│  Ollama ─┤             ├─ developer (파일/코드)             │
│  OpenAI ─┤    goose    ├─ memory (기억)                     │
│  Claude ─┤             ├─ GitHub (버전관리)                 │
│  Gemini ─┤             ├─ Slack (알림)                      │
│          │             ├─ 커스텀 MCP...                     │
│          └─────────────┘                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 자주 하는 오해

### 오해 1: "Ollama가 MCP 서버다"

```
❌ 틀림

Ollama = LLM 실행 엔진 (두뇌)
MCP 서버 = 도구 제공 서버 (손과 발)

둘은 완전히 다른 역할입니다.
```

### 오해 2: "goose 없이 Ollama로 다 할 수 있다"

```
❌ 틀림

Ollama 단독: 텍스트 입력 → 텍스트 출력만 가능
goose + Ollama: 실제 파일/시스템과 상호작용 가능
```

### 오해 3: "goose가 AI다"

```
❌ 틀림

goose = 에이전트 프레임워크 (오케스트레이터)
LLM (Ollama/OpenAI/Claude) = 실제 AI (추론 엔진)

goose는 AI를 활용하는 도구입니다.
```

### 오해 4: "MCP는 goose 전용이다"

```
❌ 틀림

MCP (Model Context Protocol)는 오픈 표준입니다.
다른 에이전트 프레임워크도 MCP를 사용할 수 있습니다.
goose는 MCP를 활용하는 에이전트 중 하나입니다.
```

---

## 요약

```
┌─────────────────────────────────────────────────────────────┐
│                       핵심 요약                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🧠 LLM (Ollama)                                            │
│     = 생각하고 판단하는 두뇌                                 │
│     = 텍스트 이해, 추론, 생성                                │
│     = 혼자서는 외부 세계와 상호작용 불가                     │
│                                                             │
│  🎯 goose                                                   │
│     = 두뇌와 도구를 연결하는 에이전트                        │
│     = 세션, 컨텍스트, 권한, 흐름 관리                        │
│     = LLM이 실제 세계와 상호작용하게 함                      │
│                                                             │
│  🔧 MCP 서버                                                │
│     = 실제 작업을 수행하는 도구들                            │
│     = 파일, 시스템, 외부 서비스 접근                         │
│     = goose를 통해 LLM과 연결됨                              │
│                                                             │
│  ═══════════════════════════════════════════════════════   │
│                                                             │
│  goose = LLM + MCP를 조합하여                               │
│          자율적으로 작업을 수행하는 AI 에이전트              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 참고 자료

- [goose 공식 문서](https://block.github.io/goose/)
- [MCP 프로토콜 문서](https://modelcontextprotocol.io/)
- [Ollama 공식 사이트](https://ollama.com/)
- [goose GitHub 저장소](https://github.com/block/goose)
